<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <title>Şans Oyunu</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: darkgrey;
            color: white;
            text-align: center;
            padding: 50 px;
            text-shadow: 1px 1px 2px black;
            font-size: 20px;
        }
        
        input, button {
            font-size: 15px;
            padding: 8px;
            margin: 5px;
            border: none;
            border-radius: 5px;
        }

        #guessT, #diamondT {
            width: 200px;
            background-color: lightblue;
            color: black;
        }

        #guessB, #diamondB {
            background-color: lightsalmon;
        }

        #reset {
            background-color: rgb(137, 128, 240);
            color: black;
            position: absolute;
            right: 10px;
            bottom: 10px;
        }

        #infoB {
            background-color: rgb(129, 255, 70);
            position: absolute;
            left: 10px;
            bottom: 10px;
        }

        #area1b{
            background-color: rgb(255, 135, 121);
            height: 30px;
            width: 150px;
        }

        #mineb {
            background-color: rgb(254, 237, 0);
            position: absolute;
            left: 93%;
            top: 2%;
            height: 30px;
            width: 100px;
        }

        #shop {
            background-color: rgb(214, 64, 44);
            position: absolute;
            top: 10px;
            left: 10px;
            width: 100px;
        }

        .shopkutucuk, .minekutucuk {
            border: 2px solid rgba(0, 0, 0, 0.856);
            background-color: rgb(179, 240, 219);
            padding: 15px;
            border-radius: 10px;
            width: 350px;
            height: 400px;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            display: none;
            color: black;
            z-index: 100;
        }
    </style>
</head>
<body>

    <h1>Şans Oyunu</h1>
    <h5>1 ile 10 Arasında Bir Sayı Tahmin Et</h5>

    <button id="mineb" onclick="minebox()">Maden</button>

    <div>
        <input id="guessT" type="text" placeholder="Tahminin" />
        <button id="guessB" onclick="TahminiYakala()">Tahmin Yap</button>
    </div>

    <div>
        <input id="diamondT" type="text" placeholder="Yatırılan Elmas" />
        <button id="diamondB" onclick="ElmasMiktariniAyarla()">Elmas Miktarı</button>
    </div>

    <p id="puan"></p>
    <p id="tahminSonucu"></p>
    <p id="yatirilanElmasMiktari"></p>

    <button id="reset" onclick="resetOyun()">Sıfırla</button>
    <button id="infoB" onclick="oyunBilgisi()">Nasıl oynanır?</button>

    <div class="shopkutucuk">
        <strong>Dükkan</strong><br><br>
        Burada gelecekte eşyalar veya güçlendirmeler satılabilir.
    </div>

    <div class="minekutucuk">
        <strong>Maden</strong>
        <p>Dükkandan Alıp Güçlendirdiğiniz İşçiler Burada Çalışır.</p>
        <button id="area1b" onclick="alert('Bu özellik şu an aktif değil.!');">Maden 1'e git</button> 
    </div>

    <script>
        let puan = 500;
        let yatirilanElmas = 0;
        let dogruTahminSayisi = 0;
        let tahminSayisi = 0;
        let rastgeleSayi = Math.floor(Math.random() * 10) + 1;

        // Verileri üst pencereye (ana sayfaya) gönderen fonksiyon
        function verileriGonder() {
            // Güvenlik notu: Eğer ana HTML dosyanız belirli bir domain'de yayınlanacaksa,
            // '*' yerine o domain'i (örneğin 'http://www.anadomain.com') yazmak daha güvenlidir.
            window.parent.postMessage({
                type: 'oyunVerisiGuncelleme', // Mesaj tipi, ana sayfada bunu kontrol edeceğiz
                puan: puan,
                yatirilanElmas: yatirilanElmas
            }, '*'); // Şu an için tüm originlere izin veriyoruz (GitHub Pages için genelde sorun olmaz)
        }

        function TahminiYakala() {
            const tahmin = parseInt(document.getElementById("guessT").value);

            if (isNaN(tahmin) || tahmin < 1 || tahmin > 10) {
                document.getElementById("tahminSonucu").textContent = "1 ile 10 arasında bir sayı gir.";
                return;
            }

            if (yatirilanElmas < 50) {
                document.getElementById("tahminSonucu").textContent = "En az 50 elmas yatırmalısın.";
                return;
            }

            if (puan < yatirilanElmas) {
                document.getElementById("tahminSonucu").textContent = "Yetersiz puan!";
                return;
            }

            tahminSayisi++;

            if (tahmin === rastgeleSayi) {
                dogruTahminSayisi++;
                let kazanilan = dogruTahminSayisi === 1 ? yatirilanElmas * 5 : Math.floor(yatirilanElmas * 1.5);
                puan += kazanilan;
                rastgeleSayi = Math.floor(Math.random() * 10) + 1;
                tahminSayisi = 0;
                document.getElementById("tahminSonucu").textContent = `Doğru tahmin! Kazandın: ${kazanilan} elmas.`;
            } else {
                dogruTahminSayisi = 0;
                puan -= yatirilanElmas;
                document.getElementById("tahminSonucu").textContent = `Yanlış tahmin (${tahmin}). ${yatirilanElmas} elmas kaybettin.`;
            }

            document.getElementById("puan").textContent = "Puan: " + puan;
            verileriKaydet();
            verileriGonder(); // Veri değişti, ana sayfaya gönder
        }

        function ElmasMiktariniAyarla() {
            const giris = parseInt(document.getElementById("diamondT").value);
            if (isNaN(giris) || giris <= 0) {
                document.getElementById("yatirilanElmasMiktari").textContent = "Geçerli bir elmas miktarı girin.";
                yatirilanElmas = 0;
            } else {
                yatirilanElmas = giris;
                document.getElementById("yatirilanElmasMiktari").textContent = "Yatırılan Elmas: " + yatirilanElmas;
            }
            verileriKaydet();
            verileriGonder(); // Veri değişti, ana sayfaya gönder
        }

        function verileriKaydet() {
            localStorage.setItem('puan', puan);
            localStorage.setItem('yatirilanElmas', yatirilanElmas);
            localStorage.setItem('tahminSayisi', tahminSayisi);
            localStorage.setItem('rastgeleSayi', rastgeleSayi);
        }

        function verileriSifirla() {
            localStorage.clear();
            puan = 500;
            yatirilanElmas = 0;
            tahminSayisi = 0;
            dogruTahminSayisi = 0;
            rastgeleSayi = Math.floor(Math.random() * 10) + 1;
            document.getElementById("puan").textContent = "Puan: " + puan;
            document.getElementById("yatirilanElmasMiktari").textContent = "Yatırılan Elmas: " + yatirilanElmas;
            verileriGonder(); // Veri sıfırlandı, ana sayfaya gönder
        }

        function resetOyun() {
            if (confirm("Oyunu sıfırlamak istediğinize emin misiniz?")) {
                verileriSifirla();
                document.getElementById("tahminSonucu").textContent = "Oyun sıfırlandı. Yeni bir oyun başladı.";
            }
        }

        function oyunBilgisi() {
            alert("1 ile 10 arasında bir sayı tahmin et. En az 50 elmas yatırmalısın. İlk doğru tahminde 5 katı kazanırsın, yanlış tahminde yatırdığın elmas kaybolur.");
        }

        function toggleShopBox() {
            const shopkutucuk = document.querySelector('.shopkutucuk');
            shopkutucuk.style.display = (shopkutucuk.style.display === 'none' || shopkutucuk.style.display === '') ? 'block' : 'none';
        }

        function minebox() {
            const minekutucuk = document.querySelector('.minekutucuk');
            minekutucuk.style.display = (minekutucuk.style.display === 'none' || minekutucuk.style.display === '') ? 'block' : 'none';
        }

        // Sayfa yüklendiğinde kayıtlı verileri getir ve ilk gönderimi yap
        window.onload = function () {
            const kayitliPuan = localStorage.getItem('puan');
            const kayitliYatirilan = localStorage.getItem('yatirilanElmas');
            const kayitliTahminSayisi = localStorage.getItem('tahminSayisi');
            const kayitliSayi = localStorage.getItem('rastgeleSayi');

            if (kayitliPuan !== null) puan = parseInt(kayitliPuan);
            if (kayitliYatirilan !== null) yatirilanElmas = parseInt(kayitliYatirilan);
            if (kayitliTahminSayisi !== null) tahminSayisi = parseInt(kayitliTahminSayisi);
            if (kayitliSayi !== null) rastgeleSayi = parseInt(kayitliSayi);
            else rastgeleSayi = Math.floor(Math.random() * 10) + 1;

            document.getElementById("puan").textContent = "Puan: " + puan;
            document.getElementById("yatirilanElmasMiktari").textContent = "Yatırılan Elmas: " + yatirilanElmas;

            verileriGonder(); // Sayfa yüklendiğinde mevcut verileri ana sayfaya gönder
        };
    </script>
</body>
</html>
